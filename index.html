<!doctype html>
<html lang="en" prefix="og: http://ogp.me/ns#">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- SEO -->
    <title>Symfony, React y 7,5 Millones de usuarios diarios</title>
    <meta name="description" content="Symfony, React y 7,5 Millones de usuarios diarios una magnifica presentacion realizada en la edicion 2017 de deSymfony">
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,700,700i%7CMaitree:200,300,400,600,700&amp;subset=latin-ext" rel="stylesheet">
    <link rel="stylesheet" type='text/css' media='all' href="static/css/base.css">
    <link rel="stylesheet" type='text/css' media='all' href="static/css/colors.css">
    <link rel="stylesheet" type='text/css' media='all' href="static/css/svg-icons.css">
    <link rel="stylesheet" type='text/css' media='all' href="static/css/font-awesome.min.css">
    <link rel="stylesheet" type='text/css' media='all' href="static/css/highlight/darcula.css">


    <!-- FACEBOOK -->
    <meta property="og:url" content="http://slides.solilokiam.com/deSymfony2017/symfony-react-7-5-millones-de-usuarios-diarios">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Symfony, React y 7,5 Millones de usuarios diarios">
    <meta property="og:description" content="Symfony, React y 7,5 Millones de usuarios diarios una magnifica presentacion realizada en la edicion 2017 de deSymfony">
    <meta property="og:updated_time" content="2017-01-04T17:20:50">
    <meta property="og:image" content="static/images/share-webslides.jpg">

    <!-- TWITTER -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:creator" content="@solilokiam">
    <meta name="twitter:title" content="Symfony, React y 7,5 Millones de usuarios diarios">
    <meta name="twitter:description" content="Symfony, React y 7,5 Millones de usuarios diarios una magnifica presentacion realizada en la edicion 2017 de deSymfony">
    <meta name="twitter:image" content="static/images/share-webslides.jpg">

    <!-- FAVICONS -->
    <link rel="shortcut icon" sizes="16x16" href="static/images/favicons/favicon.png">
    <link rel="shortcut icon" sizes="32x32" href="static/images/favicons/favicon-32.png">
    <link rel="apple-touch-icon icon" sizes="76x76" href="static/images/favicons/favicon-76.png">
    <link rel="apple-touch-icon icon" sizes="120x120" href="static/images/favicons/favicon-120.png">
    <link rel="apple-touch-icon icon" sizes="152x152" href="static/images/favicons/favicon-152.png">
    <link rel="apple-touch-icon icon" sizes="180x180" href="static/images/favicons/favicon-180.png">
    <link rel="apple-touch-icon icon" sizes="192x192" href="static/images/favicons/favicon-192.png">

    <!-- Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#333333">

  </head>
  <body>
    <main role="main">
      <article id="webslides">
        <section class="bg-black">
         <span class="background dark" style="background-image:url('static/images/backgrounds/jan-erik-waider-144384.jpg')"></span>
          <!--.wrap = container (width: 90%) -->
          <div class="wrap aligncenter">
            <h1><strong>Symfony, React y 7,5 M de usuarios diarios</strong></h1>
            <p class="text-intro">o como transformamos nuestra V en un nuevo MVC</p>
          </div>
          <!-- .end .wrap -->
        </section>
        <section>
          <div class="wrap fadeInUp">
            <h1>Gracias a los Patrocinadores</h1>
          </div>
        </section>
        <section>
          <div class="wrap fadeInUp">
            <h1>¿Quien soy?</h1>
          </div>
        </section>
        <section class="fullscreen">
          <div class="card-50">
            <figure>
              <img src="static/images/avatar.jpg" alt="Miquel Company Rodriguez">
            </figure>
            <!-- end figure-->
            <div class="flex-content">
              <h2><strong>Miquel Company</strong></h2>
              <p class="text-intro">Fullstack Developer en Kodify</p>
              <ul class="flexblock specs">
                <li>
                  <div>
                    <h2>
                      <i class="fa fa-briefcase fa-pull-left fa-3x"></i>
                      7+ años trabajando con Symfony
                    </h2>
                    El último año y medio haciendo cosas con React
                  </div>
                </li>
                <li>
                  <div>
                    <h2>
                      <i class="fa fa-home fa-pull-left fa-3x"></i>
                      Padre de familia
                    </h2>
                    Aerotrastornado, whovian y piloto FPV
                  </div>
                </li>
                <li>
                  <div>
                    <h2>
                      <i class="fa fa-twitter fa-pull-left fa-2x"></i>
                      solilokiam
                    </h2>
                  </div>
                </li>
                <li>
                  <div>
                    <h2>
                      <i class="fa fa-github fa-pull-left fa-2x"></i>
                      http://github.com/solilokiam
                    </h2>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </section>
        <section class="bg-white">
          <div class="wrap aligncenter">
            <img src="static/images/logos/kodify.svg" width="200"/>
            <ul class="flexblock metrics">
              <li><span>7</span>sites</li>
              <li><span>7,5M</span> usuarios diarios</li>
              <li><span>8500TB+</span> servidos al mes</li>
              <li><span>133M</span> requests diarias</li>
              <li><span>30000+</span> horas de video servidos al día</li>
              <li><span>600000+</span> videos</li>
            </ul>
          </div>
        </section>
        <section>
          <div class="wrap fadeInDown aligncenter">
            <h1>¿Pero qué hacemos en Kodify?</h1>
          </div>
        </section>
        <section class="bg-black">
          <div class="wrap aligncenter">
            <ul class="flexblock metrics">
              <li><img src="static/images/logos/PornTube.png"/></li>
              <li><img src="static/images/logos/4tube-logo.png"/></li>
              <li><img src="static/images/logos/pornerbros-logo.png"/></li>
              <li><img src="static/images/logos/fux-logo.png"/></li>
            </ul>
          </div>
        </section>
        <section>
          <div class="wrap aligncenter">
            <ul class="flexblock metrics">
              <li><img src="static/images/logos/blacked-logo.png"/></li>
              <li><img src="static/images/logos/tushy-logo.png"/></li>
              <li><img src="static/images/logos/vixen-logo.png"/></li>
            </ul>
          </div>
        </section>
        <section>
          <h1>Siempre estamos buscando talento...</h1>
        </section>
        <section class="bg-black">
          <span class="background" style="background-image:url('static/images/backgrounds/couch.jpg')"></span>
          <div class="wrap aligncenter">
            <h1>Join us @kodify.io</h1>
          </div>
        </section>
        <section class="bg-black">
          <span class="background dark" style="background-image:url('static/images/backgrounds/nasa-43979.jpg')"></span>
           <!--.wrap = container (width: 90%) -->
           <div class="wrap aligncenter">
             <h1><strong>Un poco de história</strong></h1>
           </div>
           <!-- .end .wrap -->
        </section>
        <section class="bg-white">
          <!--.wrap = container (width: 90%) -->
           <div class="wrap">
              <div class="card-50">
                <figure>
                  <img src="static/images/olddiagram.svg"/>
                </figure>
                <div class="flex-content">
                  <h2>Hasta Ahora</h2>
                  <p>Apache, PHP5.6, Symfony 2.7, ElasticSearch, AuroraDB, Redis, Jquery, Gulp, CSS3, Chef, Cloudformation, PHPUnit, Behat, Selenium, Codeship</p>
                </div>

              </div>
           </div>
           <!-- .end .wrap -->
        </section>
        <section class="bg-white">
          <!--.wrap = container (width: 90%) -->
           <div class="wrap aligncenter">
              <div class="flex-content">
                <h2>¿Que no nos acaba de funcionar?</h2>
                <ul class="flexblock features">
                  <li>
                    <h2><i class="fa fa-paint-brush fa-2x" aria-hidden="true"></i> Frontend</h2>
                    CSS que ha engordado<br/>
                    Jquery<br/>
                    Twig<br/>
                    2 versiones (desktop/mobile)
                  </li>
                  <li>
                    <h2><i class="fa fa-server fa-2x" aria-hidden="true"></i> Backend</h2>
                    Controladores que han cogido peso<br/>
                    Modelo Anémico<br/>
                  </li>
                  <li>
                    <div>
                      <h2><i class="fa fa-microchip fa-2x" aria-hidden="true"></i> Infrastructura</h2>
                      Chef<br/>
                      Autoescalado Manual<br/>
                      Costes<br/>
                      Tiempo de Build Lento
                    </div>
                  </li>
                </ul>
              </div>
           </div>
           <!-- .end .wrap -->
        </section>
        <section class="bg-white">
          <div class="wrap">
            <h1>Hace unos meses...</h1>
            <blockquote class="text-quote">
              <p>Nuestro site se esta quedando antiguo y necesita un lavado de cara</p>
            </blockquote>
          </div>
        </section>
        <section class="bg-black">
          <span class="background dark" style="background-image:url('static/images/backgrounds/isaac-wendland-172508.jpg')"></span>
          <div class="wrap">
            <h1>Empieza la lista a los reyes magos...</h1>
          </div>
        </section>
        <section class="bg-black">
          <span class="background dark" style="background-image:url('static/images/backgrounds/grace-p-197521.jpg')"></span>
          <div class="wrap">
            <h1>Queridos reyes magos...</h1>
            <div class="grid">
              <div class="column">
                <ul class="description text-intro">
                  <li>Limpiar y hacer nuestro CSS modular con SASS</li>
                  <li>Poner orden a JQuery</li>
                  <li>Mobile First</li>
                  <li>Poner los controladores a dieta</li>
                  <li>Cambiar la manera como orquestramos</li>
                </ul>
              </div>
              <div class="column">
                <ul class="description text-intro">
                  <li>Poner orden a las plantillas de twig</li>
                  <li>DDD</li>
                  <li>Jenkins</li>
                  <li>Symfony 3</li>
                  <li>Live Reload</li>
                </ul>
              </div>
            </div>
          </div>
        </section>
        <section class="bg-black">
          <span class="background dark" style="background-image:url('static/images/backgrounds/rodion-kutsaev-184298.jpg')"></span>
          <div class="wrap fadeInUp aligncenter">
            <h1>Mobile First</h1>
            <p class="text-subtitle">Más de la mitad de nuestros users utilizan la versión mobile</p>
          </div>
        </section>
        <section class="bg-black">
          <span class="background dark" style="background-image:url('static/images/backgrounds/rodion-kutsaev-184298.jpg')"></span>
          <div class="wrap fadeInUp">
            <h2>Nuestra aplicacion ha de ser:</h2>
              <ul class="flexblock features">
                <li><strong>Progresiva:</strong> Ha de funcionar para todos los usuarios. La mejora progresiva es el principio central.</li>
                <li><strong>Responsive:</strong> Se ha de ver bien en todos los dispositivos. Escritorio, Movil, Tablet, o lo que sea...</li>
                <li><strong>Conection Independent:</strong> Ha de poder funcionar bien, en redes lentas, o sin conexion.</li>
                <li><strong>Segura:</strong> Han de estar servidas por HTTPS/TLS</li>
                <li><strong>Ligera:</strong> Minimizar al máximo la carga, tanto de datos como de CPU<li>
              </ul>
          </div>
        </section>
        <section>
          <div class="wrap aligncenter">
            <img src="static/images/logos/react.png" width="300" />
            <h1>React All The Things</h1>
          </div>
        </section>
        <section class="bg-black">
          <span class="background dark" style="background-image:url('static/images/backgrounds/luca-bravo-186960.jpg')"></span>
           <!--.wrap = container (width: 90%) -->
           <div class="wrap aligncenter">
             <h1><strong>¿Como lo hemos montado?</strong></h1>
           </div>
           <!-- .end .wrap -->
        </section>
        <section>
          <div class="wrap">
            <div class="content-left">
              <h2>Componentes independientes</h2>
              <p>Crear una serie de componentes independientes e insertarlos en nuestras plantillas Twig</p>
              <div class="content-left">
                <h3>Pros</h3>
                <ul>
                  <li>Facil de hacer</li>
                  <li>Prototipaje rapido</li>
                  <li>Curva de aprendizaje</li>
                </ul>
              </div>
              <div class="content-left">
                <h3>Cons</h3>
                <ul>
                  <li>No aprovechar toda la potencia</li>
                  <li>No muy SEO-Friendly</li>
                  <li>Comunicación entre componentes</li>
                </ul>
              </div>
            </div>
            <div class="content-left">
              <img src="static/images/youtube-screenshot.png" alt="Youtube Screenshot">
            </div>
          </div>
        </section>
        <section>
          <div class="wrap">
            <div class="content-left">
              <img src="static/images/youtube-screenshot-clean.png" alt="Youtube Screenshot">
            </div>
            <div class="content-left">
              <h2>Single Page App</h2>
              <p>La aplicación carga una única página y la actualiza dinámicamente mientras el usuario interacciona con ella.</p>
              <div class="content-left">
                <h3>Pros</h3>
                <ul>
                  <li>Comunicación entre componentes</li>
                  <li>Flexible</li>
                  <li>SEO-Friendly con SSR</li>
                  <li>Potente</li>
                </ul>
              </div>
              <div class="content-left">
                <h3>Cons</h3>
                <ul>
                  <li>Curva de aprendizaje</li>
                  <li>V => MVC</li>
                  <li>Complicado de empezar</li>
                </ul>
              </div>
            </div>
          </div>
        </section>
        <section>
          <div class="wrap">
            <h1>Server Side Rendering</h1>
            <div class="grid">
              <div class="column">
                <p class="text-intro">Sin esto esta charla no tendria sentido.</p>
                <ul>
                  <li>Nuestra SPA renderiza el HTML en el lado de servidor.</li>
                  <li>Los Robots reciben contenido que pueden entender.</li>
                  <li>React se enlaza con el HTML renderizado en cliente</li>
                  <li>En Server Side <strong>no hay</strong> window, document, etc...</li>
                </ul>
              </div>
              <div class="column">
                <pre class="code">
<code class="js">
import React from 'react';
import { renderToString } from 'react-dom/server';

const renderApp = () => {
  const app = (
    &lt;h1&gt;Hello, world!&lt;/h1&gt;
  );

  return renderToString(component);
};
</code>
                </pre>
              </div>
            </div>
          </div>
        </section>
        <section>
          <div class="wrap aligncenter">
            <h3>SSR y Symfony</h3>
            <h3><a href="https://github.com/Limenius/ReactBundle">https://github.com/Limenius/ReactBundle</a></h3>
            <p><img class="avatar-80" src="static/images/nachoavatar.jpg"/></p>
          </div>
        </section>
        <section class="fullscreen">
            <div class="grid">
              <div class="column">
                <pre>
<code class="twig">
{% extends 'base.html.twig' %}

{% block body %}
  {{ react_component('ReactApp', {'props': props}) }}
{% endblock %}

{% block javascripts %}
  &lt;script src="{{ asset('build/app.js') }}"&gt;&lt;/script&gt;
{% endblock %}
</code>
                </pre>
                <pre>
<code class="js">
  import ReactOnRails from 'react-on-rails'
  import ReactApp from './server/ReactApp'

  ReactOnRails.register({ ReactApp })
</code>
                </pre>
              </div>
              <div class="column">
                <pre>
<code class="twig">
/**
 * @Route("/", name="homepage")
 */
public function homeAction(Request $request)
{
    $serializer = $this->get('serializer');
    return $this->render('recipe/home.html.twig', [
        'props' => $serializer->normalize(
            ['foo' => $this->get('foo.repository')->findAll(),
             'baseUrl' => $this->generateUrl('homepage'),
             'location' => $request->getRequestUri()
            ])
    ]);
}
</code>
                </pre>
              </div>
            </div>
        </section>
        <section>
          <h1>Al 99% de la gente ya le funciona esta solución...</h1>
        </section>
        <section>
          <div class="wrapper">
            <div class="content-right">
              <h1 class="alignright">...A nosotros no</h1>
            </div>
          </div>
        </section>
        <section>
          <div class="wrap">
            <ul class="flexblock">
              <li>
                <p>PhpExecJs</p>
                <img src="static/images/LoadingTimeline.png" width="583"/>
              </li>
              <li>
                <p>External Node Server</p>
                <img src="static/images/LoadingTimeline2.png" width="413"/>
              </li>
            </ul>
            <p class="alignright">*No estan a escala</p>
          </div>
        </section>
        <section class="bg-white">
          <div class="wrap aligncenter">
            <img src="static/images/logos/expressjs.png" />
          </div>
        </section>
        <section>
          <div class="wrap">
            <h2>¿Que hacemos con ExpressJS?</h2>
            <p class="text-intro">
              Una aplicacion muy simple con solamente 2 misiones.
            </p>
            <ul class="flexblock features">
              <li>
                <div>
                  <h2><i class="fa fa-paint-brush" aria-hidden="true"></i> Renderizar SSR</h2>
                  Controlador único.<br>
                  Routing gestionado desde React.<br>
                  Cache de Vista
                </div>
              </li>
              <li>
                <div>
                  <h2><i class="fa fa-server" aria-hidden="true"></i> Proxy de la API</h2>
                  Frontend no se contecta directamente con el backend.<br>
                  Cacheamos la mayoria de responses.<br>
                  Cocinamos datos.
                </div>
              </li>
            </ul>
          </div>
        </section>
        <section>
          <div class="wrap">
            <ul class="flexblock">
              <li>
                <h2>Worst Case Scenario</h2>
                <img src="static/images/ExpressTimeline.png" width="366"/>
              </li>
              <li>
                <h2>Best Case Scenario</h2>
                <img src="static/images/ExpressBestCaseTimeline.png" width="55"/>
              </li>
            </ul>
            <p class="alignright">*No estan a escala</p>
          </div>
        </section>
        <section class="aligncenter">
          <h1>¿Y el Backend?</h1>
        </section>
        <section>
          <div class="wrap">
            <h2>Backend</h2>
            <p class="textintro">Hemos reescrito la aplicación antigua completamente. Utilizando "mejores practicas".</p>
            <ul class="flexblock features">
              <li><h2>CQRS</h2> Lectura desde ElasticSearch, Escritura a MySQL (Aurora)</li>
              <li><h2>DDD</h2> Separación por capas muy lightweight.</li>
              <li><h2>Command Bus</h2> Utilizamos Tactician.</li>
              <li><h2>Serializacion</h2> Nuestro modelo devuelve objectos, colecciones de objetos, todo el trabajo lo hace el jms_serializer.</li>
              <li><h2>Legacy</h2> Hemos integrado mucho código legacy desacoplandolo con DDD.</li>
              <li><h2>Stateless</h2> Nuestro back es completamente stateless. Toda la autenticación funciona a traves de JSON Web Token.</li>
            </ul>
          </div>
        </section>
        <section>
          <div class="wrap">
            <pre>
<code class="php">
public function getHomeAction(ParamFetcher $fetcher): array
{
    $req = new GetHomeRequest($fetcher->all());

    return $this->handle($req);
}
</code>
            </pre>
          </div>
        </section>
        <section class="fullscreen">
          <div class="wrap">
            <pre>
<code class="php">
  public function handle(GetHomeRequest $request): array
      {
          $isMobile = $request->isMobile();

          $topChannels = $this->bus->handle(new GetTopChannelsRequest($request->getRaw([
              CommandRequest::LIMIT => self::TOP_CHANNELS_QTY
          ])));

          $response = array_merge(
              [
                  'mostViewedVideos' => $this->bus->handle(new GetMostViewedVideosRequest($request->getRaw([
                      CommandRequest::LIMIT => $isMobile ? self::MOBILE_VIDEOS_MOST_VIEWED_QTY : self::MOST_VIEWED_VIDEOS_QTY
                  ]))),

                  'mostRecentVideos' => $this->bus->handle(new GetRecentVideosRequest($request->getRaw([
                      CommandRequest::LIMIT =>  $isMobile ? self::MOBILE_VIDEOS_MOST_RECENT_QTY : self::RECENT_VIDEOS_QTY
                  ]))),

                  'topChannels' => array_slice($topChannels, 0, $isMobile ? self::MOBILE_TOP_CHANNELS_QTY : self::TOP_CHANNELS_TO_DISPLAY_QTY),

                  'featuredPornstars' => $this->bus->handle(new GetPornstarsRequest($request->getRaw([
                      CommandRequest::LIMIT =>  $isMobile ? self::MOBILE_FEATURED_PORNSTARS_QTY : self::FEATURED_PORNSTARS_QTY
                  ]))),
              ],
              $this->handleEmbedded($request)
          );

          return $isMobile
              ? $response
              : array_merge($response, [
                  'topChannelsVideos' => $this->getTopChannelsVideos($request, $topChannels)
              ])
          ;
      }
</code>
            </pre>
          </div>
        </section>
        <section>
          <div class="wrap">
            <h1>Routing</h1>
            <div class="grid">
              <div class="column">
                <ul class="flexblock specs">
                  <li>Completamente gestionado desde React</li>
                  <li>React Router 4 (aunque empezamos con el 3)</li>
                  <li>No conectado con el store</li>
                  <li>Composition everywhere</li>
                </ul>
              </div>
              <div class="column">
                <pre>
<code class="js">
&lt;Provider store={this.store}&gt;
  &lt;IntlProvider&gt;
    &lt;Router history={history}&gt;
      &lt;App&gt;
        &lt;RouteHandler&gt;
          &lt;RouteRenderer /&gt;
        &lt;/RouteHandler&gt;
      &lt;/App&gt;
    &lt;/Router&gt;
  &lt;/IntlProvider&gt;
&lt;/Provider&gt;
</code>
                </pre>
              </div>
            </div>
          </div>
        </section>
        <section class="fullscreen">
          <div class="wrap">
            <h2>&lt;RouteRenderer&gt;</h2>
            <p class="text-intro">Traduce de nuestro fichero de configuración a algo que entiende ReactRouter</p>
            <pre>
<code class="js">
export default [
  {
    name: 'video_page',
    path: '/videos/:slug\\_:uuid',
    component: Video,
    fetchData: dataFetcher.fetchVideoData,
  },
  {
    name: 'user_playlists',
    path: '/users/:username/playlists',
    component: UserPlaylists,
    requireAuth: true,
  },
  {
    name: 'home',
    path: `/:orientation(${orientations.ORIENTATION_GAY}|${orientations.ORIENTATION_SHEMALE})?/`,
    component: Home,
    fetchData: dataFetcher.fetchHomeData,
    exact: true,
  },
];
</code>
            </pre>
          </div>
        </section>
        <section class="fullscreen">
          <div class="wrap">
            <h2>&lt;RouteHandler&gt;</h2>
            <p class="text-intro">El chico listo de clase</p>
            <ul class="flexblock steps">
              <li>
                <h2>Peticion de datos al backend</h2>
                  Utilizando promesas y de manera asincrona.
              </li>
              <li>
                <h2>Peticion de componentes (code splitting)</h2>
                  La optimización sin querer...
              </li>
              <li>
                <h2>Mount &amp; Unmount</h2>
                No realizamos la "navegación" hasta que no tenemos los datos necesarios.
              </li>
            </ul>
          </div>
        </section>
        <section>
          <div class="wrap">
            <h1>SEO</h1>
          </div>
        </section>
        <section>
          <div class="wrap">
            <h1>Traducciones</h1>
          </div>
        </section>
        <section>
          <div class="wrap">
            <h1>Gestión de Estados</h1>
          </div>
        </section>
        <section>
          <div class="wrap">
            <h1>Gestion de Usuarios</h1>
          </div>
        </section>
        <section>
          <div class="wrap">
            <h1>Assets</h1>
          </div>
        </section>
        <section>
          <div class="wrap">
            <h1>Testing</h1>
          </div>
        </section>
      </article>
      <!-- end article -->
    </main>
    <!-- end main -->

    <!-- Required -->
    <script src="static/js/webslides.js"></script>
    <script src="static/js/highlight.pack.js"></script>
    <script>
      window.ws = new WebSlides();
      hljs.initHighlightingOnLoad();
    </script>
  </body>
</html>
